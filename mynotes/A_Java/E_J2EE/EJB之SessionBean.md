# EJB之Session Bean

EJB中Session Bean分为Stateless和Stateful。

#### 无状态（stateless）
1. 在不同方法调用间不保留任何状态。
2. 事务处理必须在一个方法中完成。
3. 通常资源占用较少，可以被多个客户端共享。

#### 有状态（stateful）
1. 可以在不同的方法调用间保持针对各个客户端的状态。
2. 通常资源占用较多，因为与客户端的联系必须被维持，客户端的状态也会被保存下来。

#### 区别的根本原因
1. 对于有状态的会话Bean，服务器会为每个客户端发来的请求创建一个Session Bean实例。这个实例与客户端是一一对应的，如果客户端在Bean里保存了信息，之后还可以使用。
2. 对于无状态的会话Bean，服务器会维持一个实例池，创建若干个Session Bean实例。当客户端发送创建会话Bean的请求时，并不一定会真的创建Session Bean实例，而是从实例池中取得一个实例返回给客户端。当客户端将Session Bean使用完毕后，重新将此会话Bean放回实例池。当客户端再次访问时，不一定获得上一次使用的会话Bean。所以，无状态会话Bean不会专门保存客户端的信息。

#### 各自的优缺点  
1. 因为有状态会话Bean需要保存客户端的信息，一个客户端对应一个实例。通常情况下，服务器会为有状态会话Bean做优化。当客户端数量超过某个数值时，就不创建新的实例。而是查看是否有实例处于连接状态，但是没有访问。如果有这样的实例，则服务器会将这个实例的状态保存起来，并用这个会话Bean实例为新的请求服务。对于原来的客户端来说，此时状态为挂起。如果原来的客户端再次发送请求，服务器会为该客户端重新查找空闲实例。并把已保存的实例恢复回来，这个过程称为激活。所以在有状态Bean的访问过程中，会发生查找实例，激活挂起操作，导致效率较低。
2. 无状态会话Bean无需保存客户端的信息。在服务器收到客户端请求时，直接在实例池中取出一个实例并返回，所以效率比较高。
