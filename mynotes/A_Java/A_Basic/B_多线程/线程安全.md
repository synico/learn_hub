## 线程安全

### 线程安全的定义
当多个线程访问某个类的实例时，不管运行环境采用何种调度方式或这些线程将如何交替运行，并且在主调代码中不需要任何额外的同步或协同，这个类的实例能表现出正确的行为，那么这个类是线程安全的。
***

### 线程封闭的方式
#### ad_hoc线程封闭
维护线程封闭性的职责完全由程序实现来负责。
#### 栈封闭
线程封闭的特例。通过局部变量访问对象。
#### ThreadLocal类
特定线程的值在加入ThreadLocal时被发布到特定的线程上。当线程终止后，通过WeakReference保存在ThreadLocal.ThreadLocalMap上的特定值和引用会被垃圾回收。
***

### 发布与逸出
可使用一个私有的构造函数和一个公共的工厂方法，从而避免不正确的构造过程，避免逸出。

### 不可变对象
不可变对象可以满足并发访问同步安全。
* Final域能保证对象初始化过程的安全性。对于final域的对象，JVM保证对对象的引用发生在对象初始化完毕后，即在构造函数执行完毕后引用。不会出现乱序执行。也就是说final域保证一旦得到该域的引用，final域的值都已完成了初始化。
#### 不可变类的设计方法
* 用final限定类不可被继承。
* 保证所有成员变量为private，并加上final修饰。
* 不提供改变成员变量的方法。
* 在getter方法中，不要返回对象本身或可变的成员变量，可返回对象的拷贝。
***
